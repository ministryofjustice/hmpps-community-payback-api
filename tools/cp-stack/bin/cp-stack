#!/usr/bin/env bash

set -e

pre_reqs() {
  if ! [ "$(command -v tilt)" ];then
      echo "Tilt could not be found. Install with ``install-dependencies.sh`` and try again"
      exit
  fi

  "$(dirname "$0")/utils/launch-docker.sh"
}

command=$1

if [ "$command" = "start" ]; then
  pre_reqs
  shift
  "$(dirname "$0")/start-server" "$@"
elif [ "$command" = "stop" ]; then
  pre_reqs
  shift
  "$(dirname "$0")/stop-server" "$@"
else
  echo "Usage: cp-stack <command>"
  echo "Commands:"
  echo "  start [--local-ui] [--local-api]"
  echo "  stop [--clear-databases]"
  exit 1
fi
